# [lib/.](Cream\lib)

## [Cream\lib\core\retrain.py](Cream\lib\core\retrain.py)

## [Cream\lib\core\test.py](Cream\lib\core\test.py)

## [Cream\lib\core\train.py](Cream\lib\core\train.py)

## [Cream\lib\models\blocks\\_\_init__.py](Cream\lib\models\blocks\__init__.py)

## [Cream\lib\models\blocks\inverted_residual_block.py](Cream\lib\models\blocks\inverted_residual_block.py)

```
class InvertedResidual(nn.Module)
```
复制的timm源码，构造一个深度广度网络，结构为“点卷积-深度卷积-压缩卷积-线性层”

```
    def feature_info(self, location):
```
功能未知，似乎是调用网络模块的信息，但好像并没有被调用过

```
    def forward(self, x):
```
组网方法

----

## [Cream\lib\models\blocks\residual_block.py](Cream\lib\models\blocks\residual_block.py)

```
def conv3x3(in_planes, out_planes, stride=1):
```
定义3*3卷积层函数

```
class BasicBlock(nn.Module):
```
定义一个结构为“3\*3卷积-3*3卷积”的网络模块

```
    def forward(self, x):
```
组网方法

```
class BasicBlock(nn.Module):
```
定义一个结构为“1\*1卷积-3\*3卷积-1*1卷积”的网络模块

```
    def forward(self, x):
```
组网方法

```
def get_Bottleneck(in_c, out_c, stride):
```
Bottleneck构造函数

```
def get_BasicBlock(in_c, out_c, stride):
```
BasicBlock构造函数

## [Cream\lib\models\builders\build_childnet.py](Cream\lib\models\builders\build_childnet.py)

```
class ChildNetBuilder:
```
分路径中可选部分的网络（包含选定）类

```
    def _round_channels(self, chs):
```
保护方法，计算？

```
    def _make_block(self, ba, block_idx, block_count):
```
保护方法，构造网络模块

```
    def __call__(self, in_chs, model_block_args):
```
重写的调用方法

## [Cream\lib\models\builders\build_supernet.py](Cream\lib\models\builders\build_supernet.py)

```
class SuperNetBuilder:
```
超网络中可选部分的网络类

```
    def _round_channels(self, chs):
```
保护方法，计算？

```
    def _make_block(self, ba, block_idx, block_count):
```
保护方法，构造网络模块

```
    def __call__(self, in_chs, model_block_args):
```
重写的调用方法

## [Cream\lib\models\structures\childnet.py](Cream\lib\models\structures\childnet.py)

```
class ChildNet(nn.Module):
```
分路径类

```
    def get_classifier(self):
```
getter方法，返回网络末端的全连接分类器

```
    def reset_classifier(self, num_classes, global_pool='avg'):
```
根据新的分类数重设网络末端的全连接分类器

```
    def forward_features(self, x):
```
除全连接分类器外的组网

```
    def forward(self, x):
```
全网络组网

```
def gen_childnet(arch_list, arch_def, **kwargs):
```
根据给定路径选项构造分路径

## [Cream\lib\models\structures\supernet.py](Cream\lib\models\structures\supernet.py)

```
class SuperNet(nn.Module):
```
超网络类

```
    def get_classifier(self):
```
getter方法，返回网络末端的全连接分类器

```
    def reset_classifier(self, num_classes, global_pool='avg'):
```
根据新的分类数重设网络末端的全连接分类器

```
    def forward_features(self, x):
```
除全连接分类器外的组网

```
    def forward(self, x):
```
全网络组网

```
    def forward_meta(self, features):
```
getter方法，返回匹配网络本体

```
    def rand_parameters(self, architecture, meta=False):
```
getter方法，返回随机层参数，用于网络训练

```
class Classifier(nn.Module):
```
1000*1000全连接分类器，不知道干什么用的

```
def gen_supernet(flops_minimum=0, flops_maximum=600, **kwargs):
```
生成超网络函数

## [Cream\lib\models\MetaMatchingNetwork.py](Cream\lib\models\MetaMatchingNetwork.py)

```
class MetaMatchingNetwork():
```
匹配网络类，可实现匹配网络相关功能，但不包含网络本体

```
    def update_student_weights_only(self, random_cand, grad_1, optimizer, model):
```
与类无关的方法，仅对输入的分路径所包含的权重进行一次训练更新

```
    def update_meta_weights_only(self, random_cand, teacher_cand, model, optimizer, grad_teacher):
```
仅更新匹配网络权重的函数

```
    def simulate_sgd_update(self, w, g, optimizer):
```
模拟梯度下降步函数，返回变量张量

```
    def calculate_1st_gradient(self, kd_loss, model, random_cand, optimizer):
```
梯度计算（针对训练集残差$L_{CE}$的梯度）

```
    def calculate_2nd_gradient(self, validation_loss, model, optimizer, random_cand, teacher_cand, students_weight):
```
梯度计算（针对知识蒸馏，即先进路径的残差$L_{KD}$的梯度）

```
    def forward_training(self, x, model, random_cand, teacher_cand, meta_value):
```
分路径与先进路径对比残差$L_{KD}$的计算函数

```
    def forward_training(self, x, model, random_cand, teacher_cand, meta_value):
```
训练样本残差$L_{CE}$的计算函数

```
    def isUpdate(self, current_epoch, batch_idx, prioritized_board):
```
检测是否本轮训练所有权重更新均已完成

```
    def run_update(self, input, target, random_cand, model, optimizer,
```
单轮训练流程（默认包含匹配网络训练）

## [Cream\lib\models\PrioritizedBoard.py](Cream\lib\models\PrioritizedBoard.py)

## [Cream\lib\utils\builder_util.py](Cream\lib\utils\builder_util.py)

## [Cream\lib\utils\flops_table.py](Cream\lib\utils\flops_table.py)

## [Cream\lib\utils\op_by_layer_dict.py](Cream\lib\utils\op_by_layer_dict.py)

## [Cream\lib\utils\search_structure_supernet.py](Cream\lib\utils\search_structure_supernet.py)

## [Cream\lib\utils\util.py](Cream\lib\utils\util.py)

## [Cream\lib\config.py](Cream\lib\config.py)

## [Cream\tools\_init_paths.py](Cream\tools\_init_paths.py)

# [tools/.](Cream\tools)

## [Cream\tools\generate_subImageNet.py](Cream\tools\generate_subImageNet.py)

## [Cream\tools\main.py](Cream\tools\main.py)

## [Cream\tools\retrain.py](Cream\tools\retrain.py)

## [Cream\tools\test.py](Cream\tools\test.py)

## [Cream\tools\train.py](Cream\tools\train.py)